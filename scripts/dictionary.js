import{loadLanguages}from"./language_switcher_core.js";const sortOrder="#,;'xzwrhsfgdbktpqnmvyieoua";function compareBySatu(e,t){for(let n=0;;n++){const o=e.charAt(n),a=t.charAt(n);if(""===o)return-1;if(""===a)return 1;const r=sortOrder.indexOf(o),l=sortOrder.indexOf(a);if(r!==l)return l-r}}function satuToSound(e){return e.replaceAll("q","ŋ").replaceAll("f","ɸ").replaceAll("sy","ʃ").replaceAll("ty","tʃ").replaceAll("dy","dʒ").replaceAll("si","ʃi").replaceAll("y","j").replaceAll("v","əm").replaceAll("r","ɾ").replaceAll("x","ɣ").replaceAll("h","x")}const wordTypes=new Map([["名称",{ja:"名称語",en:"Name"}],["過程",{ja:"過程語",en:"Process"}],["結果",{ja:"結果語",en:"Result"}],["機能",{ja:"機能語",en:"Function"}],["補助",{ja:"補助語",en:"Complementizer"}]]),partOfSpeeches={noun:{ja:"名",en:"Noun"},verb:{ja:"動",en:"Verb"},mod:{ja:"飾",en:"Mod"},conj:{ja:"接",en:"Conj"}};function buildWord({wordType:e,paramCount:t,explain:n,noun:o,verb:a,modif:r,conj:l,language:c}){const s=wordTypes.get(e)?.[c]??"",p="0"===t?`【${s}】 ${n}<br />`:`【${s}-${t}】 ${n}<br />`;let d="";if(""!==o&&(d+=`【${partOfSpeeches.noun[c]}】${o}`),""!==a){""!==d&&(d+=" ");let e=partOfSpeeches.verb[c];"●"===r&&(e+=`|${partOfSpeeches.mod[c]}`),"●"===l&&(e+=`|${partOfSpeeches.conj[c]}`),d+=`【${e}】${a}`}return""!==r&&"●"!==r&&(""!==d&&(d+=" "),d+=`【${""===a&&"●"===l?`${partOfSpeeches.mod[c]}|${partOfSpeeches.conj[c]}`:partOfSpeeches.mod[c]}】${r}`),""!==l&&"●"!==l&&(""!==d&&(d+=" "),d+=`【${partOfSpeeches.conj[c]}】${l}`),p+d}const loadDictionary=async()=>{const e=document.getElementById("template_word");if(!(e instanceof HTMLTemplateElement))return;const t=e.parentElement;if(!t)return;const n=await fetch("./dictionary.csv"),o=(await n.text()).split("\n").map(e=>e.split("\t"));o.sort((e,t)=>compareBySatu(e[0]??"",t[0]??""));const a=/\{(([a-z]+?)[sfv]?)\}/g;for(const n of o){const o=n[0]??"",r=n[1]??"",l=n[2]??"",c=n[3]??"",s=(n[4]??"").replaceAll(a,"<a href='#$2' lang='kt'>$1</a>"),p=n[5]??"",d=n[6]??"",i=n[7]??"",u=n[8]??"",f=n[9]??"",m=(n[10]??"").replaceAll(a,"<a href='#$2' lang='kt'>$1</a>"),h=n[11]??"",y=n[12]??"",g=n[13]??"",$=n[14]??"",j=e.content.cloneNode(!0),S=j.querySelector("summary");if(S){S.querySelector("a")?.setAttribute("id",o),S.querySelector(":lang(kt)").textContent=o,S.querySelector(".dict-sound").textContent=`/${satuToSound(o)}/`;const e=S.querySelector(".dict-mean");e&&(e.textContent=c,e.setAttribute("data-ls-en",f))}const A=j.querySelector("p");A&&(A.innerHTML=buildWord({wordType:r,paramCount:l,explain:s,noun:p,verb:d,modif:i,conj:u,language:"ja"}),A.setAttribute("data-ls-html-en",buildWord({wordType:r,paramCount:l,explain:m,noun:h,verb:y,modif:g,conj:$,language:"en"}))),t.appendChild(j)}loadLanguages()};window.addEventListener("DOMContentLoaded",loadDictionary),window.addEventListener("hashchange",e=>{console.log("HashChanged");const t=location.hash.replace("#",""),n=document.querySelector(`details:has(a#${t})`);n&&n.setAttribute("open","open");const o=document.getElementById(t);o&&o.scrollIntoView({block:"start",behavior:"smooth"}),e.preventDefault()});