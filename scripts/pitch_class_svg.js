import{clearChildren,createCircle,createLine}from"./svg_generator.js";import{Monzo}from"./monzo.js";const baseSize=800;function getPitchPoint(e,t){const o=e.quantizedPitch(t.quantizeEdo)*Math.PI*2;return{x:800*Math.sin(o),y:800*-Math.cos(o)}}export class PitchClassSvgGenerator{previewSvg;lineGroup;gridGroup;pitchClassGroup;colorScheme;constructor(e,t,o,i,r){this.previewSvg=e,this.lineGroup=t,this.gridGroup=o,this.pitchClassGroup=i,this.colorScheme=r}generate(e,t){if(clearChildren(this.lineGroup,this.gridGroup,this.pitchClassGroup),this.gridGroup.appendChild(createCircle(0,0,800,"none",this.colorScheme.gridStroke,"20")),t.showSteps&&t.quantizeEdo>0)for(let e=0;e<t.quantizeEdo;e++){const o=e/t.quantizeEdo*Math.PI*2,i=800*Math.sin(o),r=800*-Math.cos(o);this.gridGroup.appendChild(createCircle(i,r,24,this.colorScheme.gridStroke,"none","0"))}for(const o of e){const e=o.monzo,{x:i,y:r}=getPitchPoint(e,t),h=Math.pow(2,Math.log2(e.maxPrime)%1)-1,c=0===h?this.colorScheme.noteStroke:this.colorScheme.getPitchClassColor(h);o.mute?this.pitchClassGroup.appendChild(createCircle(i,r,28,this.colorScheme.gridStroke,"none","0")):(this.pitchClassGroup.appendChild(createCircle(i,r,48,this.colorScheme.noteFill,this.colorScheme.noteStroke,"6")),this.pitchClassGroup.appendChild(createCircle(i,r,32,c,"none","0")))}for(let o=0;o<e.length;o++)for(let i=o+1;i<e.length;i++){const r=Monzo.divide(e[i].monzo,e[o].monzo);if(1!==r.pitchDistance)continue;const h=Math.pow(2,Math.abs(r.pitch)%1)-1,c=this.colorScheme.getPitchClassColor(h),{x:n,y:s}=getPitchPoint(e[o].monzo,t),{x:l,y:a}=getPitchPoint(e[i].monzo,t);this.lineGroup.appendChild(createLine(n,s,l,a,c,"48"))}}}